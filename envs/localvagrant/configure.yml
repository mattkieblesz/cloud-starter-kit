---

- name: Configure local development environment using Vagrant
  hosts: localhost
  vars_files:
    - '{{ base_dir }}/conf/config.yml'
  tasks:
    - name: Create config dirs for each service
      file: path=store/services/{{ item.name }} state=directory mode=0755
      with_items: "{{ services }}"

    - name: Create Vagrantfile for each service
      template:
        src: Vagrantfile.j2
        dest: store/services/{{ item.name }}/Vagrantfile
      vars:
        service: "{{ item }}"
      with_items: "{{ services }}"

    - name: Copy ansible.cfg for each service
      template:
        src: ansible.cfg.j2
        dest: store/services/{{ item.name }}/ansible.cfg
      with_items: "{{ services }}"
